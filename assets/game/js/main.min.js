var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))(function(r,i){function o(t){try{c(a.next(t))}catch(e){i(e)}}function s(t){try{c(a["throw"](t))}catch(e){i(e)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,s)}c((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return a([t,e])}}function a(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(a){n=[6,a],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.hatStrs=["hat_cowboy","hat_winter","hat_christmas","hat_mammon_png","repair_hat_png"],e.animations=["music","repair","email","nod","think"],e.animationIndex=0,e.hatIndex=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addExternalInterface(),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){this.container=new egret.DisplayObjectContainer,this.addChild(this.container),this.container.x=100,this.container.y=100,this.skeletonData=RES.getRes("mascot_ske_json"),this.textureData=RES.getRes("mascot_tex_json"),this.texture=RES.getRes("mascot_tex_png");var t=new dragonBones.EgretFactory;t.addDragonBonesData(dragonBones.DataParser.parseDragonBonesData(this.skeletonData)),t.addTextureAtlasData(t.parseTextureAtlasData(this.textureData,this.texture)),this.armature=t.buildArmature("mascot"),this.armatureDisplay=this.armature.getDisplay(),dragonBones.WorldClock.clock.add(this.armature),this.container.addChild(this.armatureDisplay),this.armatureDisplay.x=0,this.armatureDisplay.y=0,this.actionFlag=0,this.armature.animation.gotoAndPlay("music"),this.setNewSlot(),egret.startTick(this.onTicker,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.click,this)},e.prototype.onTicker=function(t){this._time||(this._time=t);var e=t,n=e-this._time;return this._time=e,dragonBones.WorldClock.clock.advanceTime(n/1e3),!1},e.prototype.click=function(t){this.armature.animation.gotoAndPlay(this.animations[this.animationIndex]),"repair"==this.animations[this.animationIndex]&&(this.hatIndex=this.hatIndex+1,this.hatIndex>=this.hatStrs.length&&(this.hatIndex=0),this.setNewSlot()),this.animationIndex=this.animationIndex+1,this.animationIndex>=this.animations.length&&(this.animationIndex=0)},e.prototype.setNewSlot=function(){var t=this.armature.getSlot("hat_mammon");t&&("repair"==this.armature.animation.lastAnimationName?t.displayIndex=this.hatIndex:t.displayIndex=-1)},e.prototype.addExternalInterface=function(){var t=this;egret.ExternalInterface.addCallback("changeAnimation",function(e){egret.ExternalInterface.call("sendToNative","message = "+e),t.armature.animation.gotoAndPlay(e),t.setNewSlot()}),egret.ExternalInterface.addCallback("changeHat",function(e){egret.ExternalInterface.call("sendToNative","message = "+e),"hat_mammon"==e?t.hatIndex=0:"hat_christmas"==e?t.hatIndex=1:"hat_winter"==e?t.hatIndex=2:"hat_cowboy"==e?t.hatIndex=3:"repair_hat"==e&&(t.hatIndex=4),t.setNewSlot()})},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);